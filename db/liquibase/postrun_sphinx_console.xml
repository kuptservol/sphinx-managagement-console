<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd
    http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

    <preConditions>
        <dbms type="mysql"/>
    </preConditions>

    <changeSet author="skuptsov" id="20150824-1">
        <comment>Initial configuration templates</comment>
        <sql>
            SET NAMES utf8;
            INSERT into CONFIGURATION_TEMPLATE values(1, 'Base index template', '', 1, 0, 'INDEX', 'SIMPLE');
            INSERT into CONFIGURATION_TEMPLATE values(2, 'Base search template', '', 1, 0, 'SEARCH', 'SIMPLE');
            INSERT into CONFIGURATION_TEMPLATE values(3, 'Base configuration template', '', 1, 0, 'CONFIGURATION',
            'SIMPLE');
            INSERT into CONFIGURATION_TEMPLATE values(4, 'Base Distributed configuration template', '', 1, 0,
            'CONFIGURATION', 'DISTRIBUTED');
            INSERT into CONFIGURATION_TEMPLATE values(5, 'Base Distributed search template', '', 1, 0, 'SEARCH',
            'DISTRIBUTED');
        </sql>
        <rollback>
        </rollback>
    </changeSet>

    <changeSet author="skuptsov" id="20150824-2">
        <comment>INDEX template fields</comment>
        <sql>
            SET NAMES utf8;
            INSERT into CONFIGURATION_FIELDS values(1, 'lemmatizer_cache', '256M', 1, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(2, 'mem_limit', '512M', 1, null, null, '', null);
        </sql>
        <rollback>
        </rollback>
    </changeSet>

    <changeSet author="skuptsov" id="20150824-3">
        <comment>SEARCH template fields</comment>
        <sql>
            SET NAMES utf8;
            INSERT into CONFIGURATION_FIELDS values(5, 'max_filter_values', '8192', 2, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(6, 'read_timeout', '5', 2, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(7, 'max_packet_size', '16M', 2, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(8, 'client_timeout', '200', 2, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(9, 'unlink_old', '1', 2, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(10, 'mva_updates_pool', '1M', 2, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(11, 'seamless_rotate', '1', 2, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(12, 'max_children', '0', 2, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(13, 'max_batch_queries', '22', 2, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(14, 'preopen_indexes', '0', 2, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(15, 'thread_stack', '512K', 2, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(16, 'max_filters', '512', 2, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(17, 'query_log_format', 'sphinxql', 2, null, null, '', null);
        </sql>
        <rollback>
        </rollback>
    </changeSet>

    <changeSet author="skuptsov" id="20150824-4">
        <comment>CONFIGURATION template fields</comment>
        <sql>
            SET NAMES utf8;
            INSERT into CONFIGURATION_FIELDS values(20, 'expand_keywords', '1', 3, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(21, 'min_infix_len', '3', 3, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(22, 'morphology', 'lemmatize_ru', 3, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(23, 'index_exact_words', '1', 3, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(24, 'wordforms', '${wordforms_path}/ru.txt', 3, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(47, 'stopwords', '${stopwords_path}/ru.txt', 3, null, null, '', null);
        </sql>
        <rollback>
        </rollback>
    </changeSet>

    <changeSet author="skuptsov" id="20150824-5">
        <comment>DISTRIBUTED CONFIGURATION template fields</comment>
        <sql>
            SET NAMES utf8;
            INSERT into CONFIGURATION_FIELDS values(25, 'ha_strategy', 'noerrors', 4, null, null, '', null);
        </sql>
        <rollback>
        </rollback>
    </changeSet>

    <changeSet author="skuptsov" id="20150824-6">
        <comment>DISTRIBUTED SEARCH template fields</comment>
        <sql>
            SET NAMES utf8;
            INSERT into CONFIGURATION_FIELDS values(26, 'max_filter_values', '8192', 5, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(27, 'read_timeout', '5', 5, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(28, 'max_packet_size', '16M', 5, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(29, 'client_timeout', '200', 5, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(30, 'unlink_old', '1', 5, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(31, 'mva_updates_pool', '1M', 5, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(32, 'seamless_rotate', '1', 5, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(33, 'max_children', '0', 5, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(34, 'max_batch_queries', '22', 5, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(35, 'preopen_indexes', '0', 5, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(36, 'thread_stack', '512K', 5, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(37, 'max_filters', '512', 5, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(38, 'query_log_format', 'sphinxql', 5, null, null, '', null);
        </sql>
        <rollback>
        </rollback>
    </changeSet>

    <changeSet author="skuptsov" id="20150824-7">
        <comment>Main CONFIGURATION template for HCS</comment>
        <sql>
            SET NAMES utf8;
            INSERT into CONFIGURATION_TEMPLATE values(6, 'One char search', '', 0, 0, 'CONFIGURATION', 'SIMPLE');
            INSERT into CONFIGURATION_FIELDS values(39, 'expand_keywords', '1', 6, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(40, 'min_infix_len', '1', 6, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(41, 'morphology', 'lemmatize_ru', 6, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(42, 'index_exact_words', '1', 6, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(43, 'wordforms', '${wordforms_path}/ru.txt', 6, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(48, 'stopwords', '${stopwords_path}/ru.txt', 6, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(44, 'charset_table', '0..9, english, russian', 6, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(45, 'blend_chars', '-, _, %, U+002C, U+002E, @', 6, null, null, '', null);
            INSERT into CONFIGURATION_FIELDS values(46, 'blend_mode', 'trim_none, skip_pure', 6, null, null, '', null);
        </sql>
        <rollback>
        </rollback>
    </changeSet>

    <!-- Продолжать отсчет id для CONFIGURATION_FIELDS с 49! -->
</databaseChangeLog>


